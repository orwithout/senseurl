<!-- src\form\lib\rxdb\easy_io.test.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RxDB Base Docs Easy IO Test</title>
</head>
<body>
  <h1>RxDB Base Docs Easy IO Test</h1>
  <label>①Validate Doc</label> <button id="validateDocBtn">Validate Document</button><br><br>
  <label>②Validate Field</label> <input type="text" id="validateFieldNameInput" placeholder="Field Name"> <input type="text" id="validateFieldValueInput" placeholder="Field Value"> <button id="validateFieldBtn">Validate Field</button> <p id="validateFieldResult"></p>
  <label>③Add Doc</label> <button id="addDocBtn">Add Document</button><br><br>
  <label>④Find by ID</label> <input type="text" id="findByIdInput" placeholder="Enter document ID"> <button id="findByIdBtn">Find</button> <p id="findByIdResult"></p>
  <label>⑤Find by Name</label> <input type="text" id="findByFieldInput" placeholder="Enter document Name"> <button id="findByFieldBtn">Find</button><pre id="findByFieldResult"></pre>
  <label>⑥Query Starts With Name</label> <input type="text" id="queryStartsWithName" placeholder="Enter start of Name"> <button id="queryStartsWithNameBtn">Query</button> <pre id="queryStartsWithNameRslt"></pre>
  <label>⑥Query Starts With Tags</label> <input type="text" id="queryStartsWithTags" placeholder="Enter start of Tags"> <button id="queryStartsWithTagsBtn">Query</button> <pre id="queryStartsWithTagsRslt"></pre>
  

  <script type="module">
    import { getRxdbDocStores } from './doc_stores.js';
    const baseDocsStore = await getRxdbDocStores('doc_indexes');

    window.sampleDoc = {
      id: Date.now().toString(),
      type: 'text/txt',
      size: 1235,
      name: 'Sample Document',
      content: 'This is a sample document.',
      tags: 'cvalidate,test,sdfe',
    };


    // Validate entire document
    document.getElementById('validateDocBtn').addEventListener('click', async () => {
      const validationResult = await baseDocsStore.validator(window.sampleDoc);
      console.log(`Document validation: ${validationResult.valid ? 'Success' : 'Failed'} - ${JSON.stringify(validationResult.errors)}`);
    });

    // Validate single field
    document.getElementById('validateFieldBtn').addEventListener('click', async () => {
      const fieldName = document.getElementById('validateFieldNameInput').value;
      const fieldValue = document.getElementById('validateFieldValueInput').value;
      const validation = await baseDocsStore.validateField(fieldName, fieldValue);
      document.getElementById('validateFieldResult').textContent = `Field validation: ${validation.valid ? 'Success' : 'Failed'} - ${JSON.stringify(validation.errors)}`;
    });



    // Add sample document
    document.getElementById('addDocBtn').addEventListener('click', async () => {

      await baseDocsStore.add(window.sampleDoc);
      console.log('Sample document added:', window.sampleDoc);
    });

    // Find by ID
    document.getElementById('findByIdBtn').addEventListener('click', async () => {
      const id = document.getElementById('findByIdInput').value;
      const doc = await baseDocsStore.findById(id);
      document.getElementById('findByIdResult').textContent = JSON.stringify(doc, null, 2);
    });

    // Find by field
    document.getElementById('findByFieldBtn').addEventListener('click', async () => {
      const fieldValue = document.getElementById('findByFieldInput').value;
      const docs = await baseDocsStore.findByField('name', fieldValue);
      document.getElementById('findByFieldResult').textContent = JSON.stringify(docs, null, 2);
    });

    // Query starts with name
    document.getElementById('queryStartsWithNameBtn').addEventListener('click', async () => {
      const startsWith = document.getElementById('queryStartsWithName').value;
      const docs = await baseDocsStore.queryStartsWith('name', startsWith);
      document.getElementById('queryStartsWithNameRslt').innerText = JSON.stringify(docs, null, 2);
    });

    // Query starts with Tags
    document.getElementById('queryStartsWithTagsBtn').addEventListener('click', async () => {
      const startsWith = document.getElementById('queryStartsWithTags').value;
      const docs = await baseDocsStore.queryStartsWith('tags', startsWith);
      document.getElementById('queryStartsWithTagsRslt').innerText = JSON.stringify(docs, null, 2);
    });

  </script>
</body>
</html>
